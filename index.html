<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Configurador PROTOS</title>
  <link rel="stylesheet" href="./css/styles.css" />
</head>
<body>
  <div class="configurator">
    <h1>Configura tu casco PROTOS¬Æ paso a paso</h1>
    <p class="subtitle">
      Define modelo, talla, colores, visor y accesorios. Te mostramos solo combinaciones reales seg√∫n cat√°logo oficial 2023‚Äì2025.
    </p>

    <form id="protos-configurator">
      <!-- MODELO -->
      <div class="field">
        <label for="model">Modelo</label>
        <select id="model" name="model" required>
          <option value="">Selecciona un modelo</option>
        </select>
        <small id="modelDescription">Empieza eligiendo el uso principal: forestal, escalada, industria‚Ä¶</small>
      </div>

      <!-- TALLA + CASCO BASE -->
      <div class="row">
        <div class="field">
          <label for="size">Talla casco</label>
          <select id="size" name="size" required>
            <option value="">Selecciona un modelo primero</option>
          </select>
          <small>Rango de per√≠metro craneal recomendado por el fabricante.</small>
        </div>
        <div class="field">
          <label for="baseShell">Casco base (SKU)</label>
          <input id="baseShell" name="baseShell" type="text" readonly />
          <small>Referencia interna que se genera autom√°ticamente seg√∫n modelo, talla y colores.</small>
        </div>
      </div>

      <!-- PREVIEW DEL CASCO -->
      <div class="field">
        <label>Vista previa de colores (SVG importado desde archivos)</label>
        <div class="helmet-preview-container">
          <svg
            id="helmetPreview"
            viewBox="0 0 2793 2793"
            xmlns="http://www.w3.org/2000/svg"
          >
            <!-- Orden de capas: base (gris/contorno) ‚Üí casco (color 1) ‚Üí detalles (color 2) -->
            <g id="helmetBaseLayer"></g>
            <g id="helmetShellLayer"></g>
            <g id="helmetAccentLayer"></g>
          </svg>

          <div class="preview-labels">
            <div class="preview-label">
              <div class="preview-color-dot" id="previewShellDot"></div>
              <span>Color 1: Casco principal</span>
            </div>
            <div class="preview-label">
              <div class="preview-color-dot" id="previewAccentDot"></div>
              <span>Color 2: Detalles y orejeras</span>
            </div>
          </div>
        </div>
        <small>Vista aproximada. Los colores y acabados reales pueden variar ligeramente.</small>
      </div>

      <!-- COMBINACIONES POPULARES -->
      <div class="field">
        <label>Combinaciones populares</label>
        <div class="popular-combos">
          <button type="button" class="combo-btn" data-shell="30" data-accent="80" title="Verde/Negro">
            <div class="combo-preview">
              <div class="combo-color" style="background: #00A859;"></div>
              <div class="combo-color" style="background: #000000;"></div>
            </div>
            <span>Verde/Negro</span>
          </button>
          <button type="button" class="combo-btn" data-shell="20" data-accent="80" title="Amarillo/Negro">
            <div class="combo-preview">
              <div class="combo-color" style="background: #FFFF00;"></div>
              <div class="combo-color" style="background: #000000;"></div>
            </div>
            <span>Amarillo/Negro</span>
          </button>
          <button type="button" class="combo-btn" data-shell="60" data-accent="80" title="Naranja/Negro">
            <div class="combo-preview">
              <div class="combo-color" style="background: #FF6B00;"></div>
              <div class="combo-color" style="background: #000000;"></div>
            </div>
            <span>Naranja/Negro</span>
          </button>
          <button type="button" class="combo-btn" data-shell="10" data-accent="80" title="Rojo/Negro">
            <div class="combo-preview">
              <div class="combo-color" style="background: #E30613;"></div>
              <div class="combo-color" style="background: #000000;"></div>
            </div>
            <span>Rojo/Negro</span>
          </button>
          <button type="button" class="combo-btn" data-shell="40" data-accent="90" title="Azul/Blanco">
            <div class="combo-preview">
              <div class="combo-color" style="background: #0066CC;"></div>
              <div class="combo-color" style="background: #FFFFFF; border: 1px solid #ddd;"></div>
            </div>
            <span>Azul/Blanco</span>
          </button>
          <button type="button" class="combo-btn" data-shell="80" data-accent="60" title="Negro/Naranja">
            <div class="combo-preview">
              <div class="combo-color" style="background: #000000;"></div>
              <div class="combo-color" style="background: #FF6B00;"></div>
            </div>
            <span>Negro/Naranja</span>
          </button>
        </div>
        <small>Haz clic en una combinaci√≥n para aplicarla autom√°ticamente.</small>
      </div>
      <div class="color-explanation">
        <strong>üé® Sistema de 2 colores PROTOS¬Æ:</strong><br>
        <strong>Color 1 (Shell):</strong> Color principal del casco exterior<br>
        <strong>Color 2 (Detalles):</strong> Color de orejeras, protecci√≥n auditiva y elementos secundarios
      </div>
      
      <div class="field">
        <label>Color 1 - Casco (Shell)</label>
        <div id="shellColorPicker" class="color-picker"></div>
        <input type="hidden" id="shellColor" name="shellColor" required />
        <small>Color principal de la calota exterior del casco.</small>
      </div>

      <div class="field">
        <label>Color 2 - Detalles / Orejeras</label>
        <div id="accentColorPicker" class="color-picker"></div>
        <input type="hidden" id="accentColor" name="accentColor" required />
        <small>Color para protecci√≥n auditiva, orejeras y detalles secundarios.</small>
      </div>

      <!-- VISOR -->
      <div class="field">
        <label for="visor">Visor</label>
        <select id="visor" name="visor" required>
          <option value="">Selecciona un modelo primero</option>
        </select>
        <small id="visorInfo">Seg√∫n el modelo, solo ver√°s visores t√©cnicamente compatibles.</small>
        <div id="visorIncluded" class="included-box" style="display: none; margin-top: 0.5rem;">
          <strong>‚úì Incluido en el precio:</strong>
          <span id="visorIncludedText"></span>
        </div>
      </div>

      <!-- PERSONALIZACI√ìN VISOR -->
      <div class="field" id="visorCustomSection" style="display: none;">
        <label for="visorCustom">Personalizaci√≥n del visor (opcional)</label>
        <div style="margin-bottom: 0.5rem;">
          <input type="file" id="visorCustomFile" accept=".svg,.ai,.eps,.pdf,.png,.jpg" style="font-size: 0.85rem;" />
        </div>
        <textarea id="visorCustomNotes" name="visorCustomNotes" rows="2"
          placeholder="Describe tu dise√±o: logo, colores espec√≠ficos, posici√≥n preferida..."></textarea>
        <small>
          üí° <strong>Recomendaciones:</strong> Formato vectorial (SVG, AI, EPS) preferido. Dise√±os con l√≠neas simples y buen contraste funcionan mejor en visores met√°licos. Los detalles muy finos pueden no verse bien.
        </small>
      </div>

      <!-- ACCESORIOS COMPATIBLES -->
      <div class="field">
        <label>Accesorios opcionales</label>
        <div id="includedAccessoriesInfo" class="included-box" style="display: none;">
          <strong>‚úì Incluido de serie:</strong>
          <ul id="includedList"></ul>
        </div>
        <div id="accessoriesContainer" class="accessories-group"></div>
        <small>Solo se muestran accesorios compatibles con el modelo elegido. Los que aparecen marcados ya van incluidos de serie.</small>
      </div>

      <!-- NOTAS EXTRA DEL CLIENTE -->
      <div class="field">
        <label for="customNotes">Notas extra para tu pedido (opcional)</label>
        <textarea id="customNotes" name="customNotes" rows="3"
          placeholder="Por ejemplo: logo de empresa, preferencia de montaje, observaciones‚Ä¶"></textarea>
      </div>

      <button type="submit">A√±adir configuraci√≥n</button>
      <button type="button" id="resetBtn">Restablecer configuraci√≥n</button>

      <!-- RESUMEN NORMALIZADO -->
      <div class="summary">
        <h2>Resumen t√©cnico (para tu backend)</h2>
        <p>Esto es un ejemplo de c√≥mo podr√≠as serializar la configuraci√≥n para tu sistema:</p>
        <pre id="summaryJson">{}</pre>
      </div>

      <input type="hidden" id="normalizedConfig" name="normalizedConfig" value="">
    </form>
  </div>

  <script src="./js/helmetSvgLoader.js"></script>
  <script src="./js/helmetPreview.js"></script>
  <script src="./js/configurator.js"></script>
</body>
</html>